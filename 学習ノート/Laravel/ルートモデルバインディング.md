#Laravel 

## 従来の方法 vs ルートモデルバインディング

### 【従来の方法】IDを渡す場合
````php
// ルート定義
Route::get('/admin/book/{id}', 'show');

// コントローラー
public function show($id)
{
    // 自分でDBから取得する必要がある
    $book = Book::findOrFail($id);
    return view('book.show', compact('book'));
}
```

**データの流れ:**
```
URL: /admin/book/5
  ↓
ルーター: パラメータ {id} = 5 を抽出
  ↓
コントローラー: show($id) ← 5(整数)が渡される
  ↓
手動でDB検索: Book::findOrFail(5)
  ↓
Bookモデルのインスタンスを取得
````

### 【ルートモデルバインディング】

````php
// ルート定義
Route::get('{book}', 'show')->whereNumber('book')->name('show');

// コントローラー
public function show(Book $book)  // ← 型ヒントに注目!
{
    // すでに$bookにはBookモデルのインスタンスが入っている!
    return view('book.show', compact('book'));
}
```

**データの流れ:**
```
URL: /admin/book/5
  ↓
ルーター: パラメータ {book} = 5 を抽出
  ↓
【Laravelが自動処理】
  Book::where('id', 5)->firstOrFail() を実行
  ↓
  Bookモデルのインスタンスを生成
  ↓
コントローラー: show(Book $book) ← Bookオブジェクトが渡される
  (もう取得済み!)
````

## 重要なポイント

### 1. **パラメータ名とコントローラーの変数名を一致させる**
```php
// ルート定義のパラメータ名
Route::get('{book}', 'show');
           ^^^^
           この名前と

// コントローラーの引数名を一致させる
public function show(Book $book)
                          ^^^^
```

### 2. **型ヒント(Type Hint)が魔法の鍵**
```php
public function show(Book $book)
                     ^^^^
                     ↑ この型ヒントがあるから
                       Laravelが自動でDBから取得してくれる
```

型ヒントがないと、ただの数値が渡されるだけです:
```php
public function show($book)  // 型ヒントなし
{
    var_dump($book);  // int(5) ← ただの数値
}

public function show(Book $book)  // 型ヒントあり
{
    var_dump($book);  // Book オブジェクト ← モデルのインスタンス
}
```

## 実際の使用例

### edit アクション
```php
// URL: /admin/book/10/edit にアクセス

// ルート
Route::get('{book}/edit', 'edit')->whereNumber('book')->name('edit');

// コントローラー
public function edit(Book $book)
{
    // $book には ID=10 の Book モデルが既に入っている
    // $book->title, $book->author などが使える
    
    return view('book.edit', compact('book'));
}
```

### Bladeビューでの利用
```blade
{{-- resources/views/book/edit.blade.php --}}

<h1>書籍編集</h1>

<form action="{{ route('book.update', $book) }}" method="POST">
    @csrf
    @method('PUT')
    
    {{-- $book->id は 10 --}}
    <input type="text" name="title" value="{{ $book->title }}">
    <input type="text" name="author" value="{{ $book->author }}">
    
    <button type="submit">更新</button>
</form>
```

## データが見つからない場合
```php
// URL: /admin/book/999 (存在しないID)
//   ↓
// Laravel が自動で 404 エラーを返す
// Book::findOrFail(999) と同じ動作
```

## まとめ

ルートモデルバインディングは:

- **URLから数値を抽出** → `/admin/book/5` から `5` を取得
- **自動でDBクエリ実行** → `Book::findOrFail(5)`
- **モデルをコントローラーに注入** → `show(Book $book)`